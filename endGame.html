<!DOCTYPE html>
<html>
 	<head>
		<link type="text/css" rel="stylesheet" href="css/endGame.css"/>
		<title>End Game</title>
	</head>
	<body onload="languageSet()">
		<div id="back">
			<button id ="startButton" onclick="goStart()"></button>
		</div>
		<script>
		if(localStorage.getItem('sound') != 'off'){
			var clickSound = new Audio('music/endGame.mp3');
			clickSound.play();
		}
		sessionStorage.score = '20';
		sessionStorage.gameDifficulty = 'hard';
		
		var scoreDiff = sessionStorage.gameDifficulty;
		var num1 = 0;
		var highScore = false;
		
		function goStart(){
			buttonSound();
			setTimeout(
			function(){window(location.href='testStart.html')}
			, 200);
		}
			
		function buttonSound(){
			if(localStorage.getItem('sound') != 'off'){
				var clickSound = new Audio('music/click.mp3');
				clickSound.play();
			}
		}
		
		function checkScore(){
			for(var k = 1; k < 4; k++){
				var diff;
				
				if(k == 1){
					diff = "easy";
				}
				else if(k == 2){
					diff = "medium";
				}
				else if(k == 3){
					diff = "hard";
				}
				for(var j = 1; j < 11; j++){
					
					if(localStorage.getItem(diff+'Score'+j) == 'null'){
						localStorage.setItem(diff+'Score'+j, '0');
						alert(diff+'Score'+j);
					}
				}
			}
			for(var j = 1; j < 11; j++){
				if(localStorage.getItem(diff+'Score'+j) == null){
					localStorage.setItem('easyScore'+j, '0');
				}
			}
	
			while(num1 < 10 && highScore == false){
				num1++;
				if(sessionStorage.score > localStorage.getItem(scoreDiff+'Score'+num1)){
					highScore = true;
				}
			}
			
			if (highScore == true){
				var player;
				while(player == null || player.length > '20'){
					if(localStorage.getItem('language') == 'english'){
						
						player = prompt("Please enter your name(max. 20)","Player1");
					}
					else{
						player = prompt("Votre Nom(max. 20)","Player1");
					}
				}
				if(player!=null){
					var rankNum = 10;
					while(rankNum > num1){
						localStorage.setItem(scoreDiff+'Name'+rankNum,localStorage.getItem(scoreDiff+'Name'+(rankNum-1)));
						localStorage.setItem(scoreDiff+'Score'+rankNum,localStorage.getItem(scoreDiff+'Score'+(rankNum-1)));
						localStorage.setItem(scoreDiff+'Date'+rankNum,localStorage.getItem(scoreDiff+'Date'+(rankNum-1)));
						rankNum = rankNum-1;
					}
					var currentDate = new Date();
					var day = currentDate.getDate();
					var month = currentDate.getMonth() + 1;
					var year = currentDate.getFullYear();
			
					localStorage.setItem(scoreDiff+'Name'+rankNum,player);
					localStorage.setItem(scoreDiff+'Score'+rankNum,sessionStorage.score);
					localStorage.setItem(scoreDiff+'Date'+rankNum,(day + "/" + month + "/" + year));
				}
			}
		}
		
		function languageSet(){
			if(localStorage.getItem('language') == 'english'){
				document.getElementById('back').style.backgroundImage = 'url(images/deathImageNew2.png)';
				document.getElementById("startButton").innerHTML="Restart";
			}
			else{
				document.getElementById('back').style.backgroundImage = 'url(images/deathImageNew.png)';
				document.getElementById("startButton").innerHTML="Recommencer";				
			}
			checkScore();
		}
		</script>
	</body>
</html>